-*- mode: org -*-

* GNU/Linux

** Доступ

Для получения доступа пользователю по логину и паролю OpenVPN, оператору
необходимо предоставить привелегии в HMS.

[[https://user-images.githubusercontent.com/7709598/139689139-045d95eb-dcf2-457f-9bf9-0aab7196577e.png]]

** Настройка

Скопировать файлы по аналогичным в вашей системе путям:

- etc/openvpn/login.conf
- etc/openvpn/majordomo-ca.cert
- etc/openvpn/majordomo.conf

Поменять в /etc/openvpn/login.conf логин и пароль, после запустить сервис
OpenVPN:

#+begin_src sh
  systemctl enable openvpn@majordomo.service
  systemctl start openvpn@majordomo.service
#+end_src

** FAQ

*** Резолвинг доменных имен

В случае, если OpenVPN клиент не настроил резолвинг, то можно настроить в
ручную:

#+begin_example
  echo 'nameserver 172.16.102.2' | sudo tee /etc/resolv.conf
#+end_example

*** OpenVPN 2.5

https://www.opennet.ru/opennews/art.shtml?num=53981
#+begin_quote
Из конфигурации по умолчанию убрана поддержка шифра BF-CBC. В OpenVPN 2.5 по
умолчанию теперь принимаются только шифры AES-256-GCM и AES-128-GCM. Изменить
данное поведение можно при помощи опции data-ciphers, напрмер, указав в
настройках "data-ciphers AES-256-GCM:AES-128-GCM:BF-CBC", а для поддержки
очень старых узлов, не поддерживающих согласование шифров (режим "--cipher"),
можно указать "data-ciphers-fallback BF-CBC". При обновлении до новой версии
OpenVPN настройка "cipher BF-CBC" в старых файлах конфигурации будет
преобразована в добавление BF-CBC к набору data-ciphers и включён режим
data-ciphers-fallback.
#+end_quote

Тоесть необходимо добавить в файл =/etc/openvpn/majordomo.conf=:

#+begin_example
  data-ciphers AES-256-GCM:AES-128-GCM:BF-CBC
  data-ciphers-fallback BF-CBC
#+end_example

и перезапустить сервис OpenVPN:

#+begin_src sh
  sudo systemctl restart openvpn@majordomo.service
#+end_src

* Windows

1. Скачать и установить клиент [[https://swupdate.openvpn.org/community/releases/OpenVPN-2.5.4-I604-amd64.msi]]
2. Скачать файл https://raw.githubusercontent.com/mjuh/utils-openvpn/master/vpn_windows.ovpn и положить его в папку =C:\Program Files\OpenVPN\config=
3. Запустить клиент, указать логин и пароль от https://hms-billing.intr/
