-*- mode: org -*-

* GNU/Linux

** Доступ

Для получения доступа пользователю по логину и паролю OpenVPN, оператору
необходимо предоставить привелегии в HMS.

[[https://user-images.githubusercontent.com/7709598/139689139-045d95eb-dcf2-457f-9bf9-0aab7196577e.png]]

** Настройка

Скопировать файлы по аналогичным в вашей системе путям:

- etc/openvpn/login.conf
- etc/openvpn/majordomo-ca.cert
- etc/openvpn/majordomo.conf

Поменять в /etc/openvpn/login.conf логин и пароль, после запустить сервис
OpenVPN:

#+begin_src sh
  systemctl enable openvpn@majordomo.service
  systemctl start openvpn@majordomo.service
#+end_src

** FAQ

*** Резолвинг доменных имен

В случае, если OpenVPN клиент не настроил резолвинг, то можно настроить в
ручную:

#+begin_example
  echo 'nameserver 172.16.102.2' | sudo tee /etc/resolv.conf
#+end_example

*** OpenVPN 2.5

https://www.opennet.ru/opennews/art.shtml?num=53981
#+begin_quote
Из конфигурации по умолчанию убрана поддержка шифра BF-CBC. В OpenVPN 2.5 по
умолчанию теперь принимаются только шифры AES-256-GCM и AES-128-GCM. Изменить
данное поведение можно при помощи опции data-ciphers, напрмер, указав в
настройках "data-ciphers AES-256-GCM:AES-128-GCM:BF-CBC", а для поддержки
очень старых узлов, не поддерживающих согласование шифров (режим "--cipher"),
можно указать "data-ciphers-fallback BF-CBC". При обновлении до новой версии
OpenVPN настройка "cipher BF-CBC" в старых файлах конфигурации будет
преобразована в добавление BF-CBC к набору data-ciphers и включён режим
data-ciphers-fallback.
#+end_quote

Тоесть необходимо добавить в файл =/etc/openvpn/majordomo.conf=:

#+begin_example
  data-ciphers AES-256-GCM:AES-128-GCM:BF-CBC
  data-ciphers-fallback BF-CBC
#+end_example

и перезапустить сервис OpenVPN:

#+begin_src sh
  sudo systemctl restart openvpn@majordomo.service
#+end_src

* Windows

#+begin_example
  dev tap
  auth-nocache

  <connection>
  remote 81.95.28.29 1194 udp
  mssfix 0
  float
  </connection>

  <connection>
  remote 78.108.80.230 1194 udp
  mssfix 0
  float
  </connection>

  <connection>
  remote 78.108.91.250 1194 udp
  mssfix 0
  float
  </connection>

  inactive 3600
  ping 5
  ping-restart 10
  remote-random
  reneg-sec 36000
  server-poll-timeout 10
  comp-lzo
  verb 2
  auth SHA1
  auth-user-pass
  auth-retry nointeract
  client
  float
  script-security 3
  #reneg-ser 36000
  <ca>
  -----BEGIN CERTIFICATE-----
  MIIDyzCCAzSgAwIBAgIJANowWXITcAdHMA0GCSqGSIb3DQEBBQUAMIGgMQswCQYD
  VQQGEwJSVTELMAkGA1UECBMCUlUxGTAXBgNVBAcTEFNhaW50LVBldGVyc2J1cmcx
  FzAVBgNVBAoTDk1ham9yZG9tbyBMdGQuMQ8wDQYDVQQLEwZvZmZpY2UxGjAYBgNV
  BAMTEU1ham9yZG9tbyBMdGQuIENBMSMwIQYJKoZIhvcNAQkBFhRzdXBwb3J0QG1h
  am9yZG9tby5ydTAeFw0xMjA3MjUxMjA5MjhaFw0yMjA3MjMxMjA5MjhaMIGgMQsw
  CQYDVQQGEwJSVTELMAkGA1UECBMCUlUxGTAXBgNVBAcTEFNhaW50LVBldGVyc2J1
  cmcxFzAVBgNVBAoTDk1ham9yZG9tbyBMdGQuMQ8wDQYDVQQLEwZvZmZpY2UxGjAY
  BgNVBAMTEU1ham9yZG9tbyBMdGQuIENBMSMwIQYJKoZIhvcNAQkBFhRzdXBwb3J0
  QG1ham9yZG9tby5ydTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEA28CpvcRH
  Lav/CTRf88nf1uNWtB/3y4BWhZOpdP+xHqoYfLoMXKOa4f9itjmqpgOwNZB7u3AU
  P5uJrU9If8eMy6Uc9AmxM8alv7DL96PkIxbw3MTxC4HqDc7E1GJ5N9pkGO/ZFxHn
  vhHuiGR5G5yTZh+lrufhSGjWL2Dr6JX4e2cCAwEAAaOCAQkwggEFMB0GA1UdDgQW
  BBSp87/cgdG8+VS72/jdyTxLgq6DtDCB1QYDVR0jBIHNMIHKgBSp87/cgdG8+VS7
  2/jdyTxLgq6DtKGBpqSBozCBoDELMAkGA1UEBhMCUlUxCzAJBgNVBAgTAlJVMRkw
  FwYDVQQHExBTYWludC1QZXRlcnNidXJnMRcwFQYDVQQKEw5NYWpvcmRvbW8gTHRk
  LjEPMA0GA1UECxMGb2ZmaWNlMRowGAYDVQQDExFNYWpvcmRvbW8gTHRkLiBDQTEj
  MCEGCSqGSIb3DQEJARYUc3VwcG9ydEBtYWpvcmRvbW8ucnWCCQDaMFlyE3AHRzAM
  BgNVHRMEBTADAQH/MA0GCSqGSIb3DQEBBQUAA4GBAIqO8PN8arVYHPs0sBFPeaI5
  mdb4zmFGBGENPE4QgnTK9tDfG8s8cLJbsqrLJSXCTOehUV6KqKPOAnBmZCu+lJs6
  +VSpnm3ANacWZFKXejr3R92D4SAoEHCWCMUAkZh3MD+qoDR1E3PROfYdKcRf1+eR
  zlLP9L/g/sFh438M1RVq
  -----END CERTIFICATE-----
  </ca>
#+end_example
